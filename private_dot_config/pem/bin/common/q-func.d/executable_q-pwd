#!/bin/bash

function q-myip()
{
	case $(uname -a) in
	Darwin|*BSD)
		local ip=$(ifconfig  | grep -E 'inet.[0-9]' | grep -v '127.0.0.1' | awk '{ print $2}')
		;;
    *WSL2*)
        # local ip=$(ip route show | grep -i default | awk '{ print $3}')
        local ip
        if [ -x "/mnt/c/Windows/system32/ipconfig.exe" ]  ; then
            # Normally ip host do not end with *.*.*.1 or *.*.*.0
            ip=$(/mnt/c/Windows/system32/ipconfig.exe /all | grep -a IPv4 | grep -oP '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' | grep -v '\.[10]$')
        fi
        ip+=" "
		ip+=$(hostname --all-ip-addresses | tr " " "\n" | grep -v "0.0.0.0" | grep -v "127.0.0.1")
        ;;

	*)
		local ip=$(hostname --all-ip-addresses | tr " " "\n" | grep -v "0.0.0.0" | grep -v "127.0.0.1")
		;;
	esac
	echo "${ip}"
}

function q-pwd() {
if [ -n "$PEM_Q_PWD_NR" ] ; then
    local postcmd="awk 'NR == $PEM_Q_PWD_NR'"
else
    local postcmd="cat"
fi
# echo $postcmd

for x in `q-myip`
do
    if [ -z "$1" ]; then 
        echo `whoami`@$x:`pwd`
    else
        path="$(readlink -f "$1")"
        echo `whoami`@$x:"$path"
    fi 
done | eval "$postcmd"
}


q-pwd "$@"

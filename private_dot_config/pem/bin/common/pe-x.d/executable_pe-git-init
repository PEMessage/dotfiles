#!/bin/sh


runcmd() {
    echo "Runing: $*"
    "$@"
}
git_config_global() {
    key="$1"
    value="$2"

    curvalue="$(git config --global --get-all "$key")"
    
    if [ "$curvalue" = "$value" ] ; then
        return 0
    elif [ -z "$curvalue" ] ; then
        true
    else 
        runcmd git config --global --unset-all "$key"
    fi
    runcmd git config --global "$key" "$value"
}
 
git_config_global branch.sort -committerdate
git_config_global column.ui auto
git_config_global fetch.writeCommitGraph true
# git_config_global core.fsmonitor true

git_config_global alias.pk cherry-pick
git_config_global alias.co checkout
git_config_global alias.fw 'merge --ff-only'
git_config_global alias.re 'remote -v'
git_config_global alias.top 'rev-parse --show-toplevel'
git_config_global alias.st 'status --short --branch'
git_config_global alias.lg 'log --oneline --graph'
git_config_global alias.ddf 'difftool --ignore-submodules --dir-diff --no-symlinks --tool=dirdiff'
git_config_global difftool.dirdiff.cmd 'dirdiff $LOCAL $REMOTE'
git_config_global alias.contain \
    '!func() { head=HEAD ; [ "$2" ] && head="$2" ; git merge-base --is-ancestor $1 $head ; } ; func'
git_config_global alias.fbr  \
    '!func() { remote=$1 ; branch=$2 ; git fetch $remote $branch:refs/remotes/$remote/$branch ; } ; func'
# git_config_global alias.ftag  \
#     '!func() { remote=$1 ; tag=$2 ; git fetch $remote $branch:refs/tags/$tag ; } ; func'
# Credit: https://stackoverflow.com/questions/45338495/fetch-a-single-tag-from-remote-repository
git_config_global alias.ftag  \
    '!func() { remote=$1 ; tag=$2 ; git fetch $remote tag $tag --no-tags ; } ; func'
git_config_global alias.showtool \
    '!showci () { rev=${1:-HEAD}; git difftool $rev~1 $rev; }; showci $1'
